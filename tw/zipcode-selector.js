$Demeter={},$DemeterTWCityData={},$DemeterTWDistData={},$Demeter.initTWZipcodeSelector=function(e){$.ajax({url:"https://demeter.5fpro.com/tw/zipcode/cities.json",async:!1,success:function(e){$DemeterTWCityData=e}}),$.ajax({url:"https://demeter.5fpro.com/tw/zipcodes.json",async:!1,success:function(e){$DemeterTWDistData=e}});var t=function(e,t){var i=null,n=null;return $DemeterTWDistData.forEach(function(c){c.zipcode==e&&(t?t==c.name?i=c:n=c:i=c)}),i=i||n},i=function(e){return((e=$(e)).data("selected-city")||$(e.data("city")).data("selected")||"").replace("\u53f0","\u81fa")},n=function(e){var t=null;return $DemeterTWCityData.forEach(function(i){i.name==e&&(t=i)}),t},c=function(e){e=e||$(this).val();var i=$(this).val()?$(this).data("selected-dist"):null;if((e+"").length>0){e=(e+"").substring(0,3);var n=t(e,i);n?this.changeSelects(n):(this.changeCitySelect(),this.changeDistSelect())}else this.changeCitySelect(),this.changeDistSelect()},a=function(e){this.changeCitySelect(e.city_name),this.changeDistSelect(e)},o=function(e){var t=this,n=this.citySelect;n.html('<option value="">'+(this.citySelect.attr("placeholder")||"")+"</option>"),$DemeterTWCityData.forEach(function(c){if(!t.is_exclude(c.name)){var a=c.name==e||c.name==i(t)?" selected":"";n.append('<option value="'+c.name+'"'+a+">"+c.name+"</option>")}})},l=function(e){e=e||{};var t=this,c=this.distSelect;c.html('<option value="">'+(c.attr("placeholder")||"")+"</option>");var a=n(e.city_name||i(t));a&&$.get(a.zipcodes_endpoint,null,function(i){i.forEach(function(i){if(!t.is_exclude(i.zipcode)&&!t.is_exclude(i.name)){var n=i.zipcode==e.zipcode&&i.name==e.name?" selected":"";c.append('<option value="'+i.name+'" data-zipcode="'+i.zipcode+'"'+n+">"+i.zipcode+" "+i.name+"</option>")}})})},s=function(e){var t=this,i=this.distSelect;i.html('<option value="">'+(this.distSelect.attr("placeholder")||"")+"</option>");var c=n(e);$.get(c.zipcodes_endpoint,null,function(e){e.forEach(function(e){t.is_exclude(e.zipcode)||t.is_exclude(e.name)||i.append('<option value="'+e.name+'" data-zipcode="'+e.zipcode+'">'+e.zipcode+" "+e.name+"</option>")})})},r=function(e){return this.exclude.includes(e)};e=e||".js-demeter-tw-zipcode-selector",$(e).each(function(){var e=this;$(e).attr("pattern","\\d+").attr("type","tel").attr("maxlength","3").attr("minlength","3"),e.citySelect=$($(e).data("city")),e.distSelect=$($(e).data("dist")),e.applyZipcode=c,e.changeSelects=a,e.changeCitySelect=o,e.changeDistSelect=l,e.initDistSelect=s,e.exclude=($(e).data("exclude")||"").split(","),e.is_exclude=r;var t=0;$(e).on("keyup",function(){this.reportValidity&&this.reportValidity()}),$(e).on("keypress",function(i){if(i.keyCode<48||i.keyCode>57)return this.reportValidity&&this.reportValidity(),!1;clearTimeout(t),t=setTimeout(function(){e.applyZipcode()},500)}),e.citySelect.on("change",function(){$(e).val(""),e.initDistSelect($(this).val())}),e.distSelect.on("change",function(){var t=e.distSelect.find("option[value="+$(this).val()+"]").last().data("zipcode");t&&$(e).val(t)}),$(e).trigger("keypress")})},$(function(){$Demeter.initTWZipcodeSelector()});